# è§£æ¢¦APIæœ¬åœ°æœåŠ¡å™¨

è¿™æ˜¯ä¸€ä¸ªåŸºäºExpress.jsçš„æœ¬åœ°è§£æ¢¦APIæœåŠ¡å™¨ï¼Œä½¿ç”¨äº‘é›¾AIè¿›è¡Œæ¢¦å¢ƒè§£æã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨æä¾›çš„package.jsonå®‰è£…ä¾èµ–
cp package-server.json package.json
npm install
```

æˆ–è€…ç›´æ¥å®‰è£…æ‰€éœ€ä¾èµ–ï¼š

```bash
npm install express cors
```

### 2. é…ç½®API Key

åœ¨ `localserver.js` æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œå¹¶æ›¿æ¢ä¸ºä½ çš„å®é™…API keyï¼š

```javascript
"Authorization": "Bearer sk-xxxx", // è¯·æ›¿æ¢ä¸ºä½ çš„å®é™… API key
```

éœ€è¦æ›¿æ¢çš„ä½ç½®æœ‰ä¸¤å¤„ï¼š
- `/dream` æ¥å£ï¼ˆç¬¬112è¡Œï¼‰
- `/dream/simple` æ¥å£ï¼ˆç¬¬206è¡Œï¼‰

### 3. å¯åŠ¨æœåŠ¡å™¨

```bash
# å¯åŠ¨æœåŠ¡å™¨
node localserver.js

# æˆ–è€…ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3002` å¯åŠ¨ã€‚

## ğŸ“¡ APIæ¥å£

### å¥åº·æ£€æŸ¥
```
GET /health
```

### APIæ–‡æ¡£
```
GET /api-docs
```

### è¯¦ç»†è§£æ¢¦ï¼ˆæ¨èï¼‰
```
POST /dream
Content-Type: application/json

{
  "dreamContent": "æ¢¦å¢ƒå†…å®¹æè¿°",
  "dreamerInfo": {
    "age": "å¹´é¾„",
    "gender": "æ€§åˆ«",
    "occupation": "èŒä¸š",
    "currentSituation": "å½“å‰çŠ¶å†µ",
    "concerns": "ä¸»è¦å…³æ³¨çš„é—®é¢˜",
    "recentEvents": "è¿‘æœŸé‡è¦äº‹ä»¶"
  }
}
```

### ç®€å•è§£æ¢¦
```
POST /dream/simple
Content-Type: application/json

{
  "content": "æ¢¦å¢ƒå†…å®¹"
}
```

## ğŸ§ª æµ‹è¯•API

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
node test-dream-api.js
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### è¯¦ç»†è§£æ¢¦ç¤ºä¾‹

```javascript
const response = await fetch('http://localhost:3002/dream', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    dreamContent: 'æˆ‘æ¢¦è§è‡ªå·±ç«™åœ¨ä¸€åº§å¾ˆé«˜çš„å±±é¡¶ä¸Šï¼Œå‘¨å›´äº‘é›¾ç¼­ç»•ã€‚çªç„¶å‡ºç°äº†ä¸€åªé‡‘è‰²çš„é¸Ÿï¼Œå®ƒå¯¹æˆ‘è¯´è¯ï¼Œå‘Šè¯‰æˆ‘è¦å‹‡æ•¢åœ°é¢å¯¹å³å°†åˆ°æ¥çš„æŒ‘æˆ˜ã€‚',
    dreamerInfo: {
      age: '28',
      gender: 'å¥³',
      occupation: 'è®¾è®¡å¸ˆ',
      currentSituation: 'æ­£åœ¨è€ƒè™‘åˆ›ä¸šï¼Œä½†å¯¹æœªæ¥å……æ»¡ä¸ç¡®å®šæ€§',
      concerns: 'æ‹…å¿ƒåˆ›ä¸šå¤±è´¥ï¼Œå®³æ€•ç¦»å¼€èˆ’é€‚åœˆ',
      recentEvents: 'æœ€è¿‘è¾èŒäº†ï¼Œå‡†å¤‡å¼€å§‹è‡ªå·±çš„è®¾è®¡å·¥ä½œå®¤'
    }
  })
});

const result = await response.json();
console.log(result.content); // è§£æ¢¦ç»“æœ
```

### ç®€å•è§£æ¢¦ç¤ºä¾‹

```javascript
const response = await fetch('http://localhost:3002/dream/simple', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    content: 'æ¢¦è§è‡ªå·±åœ¨é£ç¿”ï¼Œæ„Ÿè§‰å¾ˆè‡ªç”±å¾ˆå¿«ä¹'
  })
});

const result = await response.json();
console.log(result.content); // è§£æ¢¦ç»“æœ
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ¨¡å‹é€‰æ‹©
- è¯¦ç»†è§£æ¢¦ä½¿ç”¨ `gpt-4o` æ¨¡å‹ï¼Œæä¾›æ›´æ·±å…¥çš„åˆ†æ
- ç®€å•è§£æ¢¦ä½¿ç”¨ `gpt-4o-mini` æ¨¡å‹ï¼Œæ›´ç»æµå®ç”¨

### å‚æ•°è°ƒæ•´
å¯ä»¥åœ¨ `localserver.js` ä¸­è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š
- `temperature`: æ§åˆ¶å›ç­”çš„åˆ›é€ æ€§ï¼ˆ0-2ä¹‹é—´ï¼‰
- `max_tokens`: æ§åˆ¶å›ç­”çš„æœ€å¤§é•¿åº¦
- `PORT`: æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤3002ï¼‰

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **API Keyå®‰å…¨**: ä¸è¦å°†åŒ…å«çœŸå®API keyçš„ä»£ç æäº¤åˆ°å…¬å…±ä»£ç åº“
2. **ç½‘ç»œè¿æ¥**: ç¡®ä¿èƒ½å¤Ÿè®¿é—® `https://yunwu.ai/v1/chat/completions`
3. **ç«¯å£å†²çª**: å¦‚æœ3002ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ `PORT` å˜é‡
4. **ä¾èµ–ç‰ˆæœ¬**: ç¡®ä¿Node.jsç‰ˆæœ¬æ”¯æŒESæ¨¡å—ï¼ˆNode.js 14+ï¼‰

## ğŸ“Š å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "content": "è§£æ¢¦ç»“æœå†…å®¹...",
  "usage": {
    "prompt_tokens": 123,
    "completion_tokens": 456,
    "total_tokens": 579
  },
  "model": "gpt-4o"
}
```

### é”™è¯¯å“åº”
```json
{
  "error": "é”™è¯¯æè¿°",
  "details": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"
}
```

## ğŸ” è°ƒè¯•

æœåŠ¡å™¨ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- è¯·æ±‚æ¥æ”¶æ—¥å¿—
- ä¼ ç»™AIçš„å®Œæ•´æ¶ˆæ¯
- APIå“åº”æ•°æ®
- é”™è¯¯ä¿¡æ¯

## ğŸ“š æ‰©å±•åŠŸèƒ½

ä½ å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•ä»¥ä¸‹åŠŸèƒ½ï¼š
- æ·»åŠ ç”¨æˆ·è®¤è¯
- å®ç°ä¼šè¯ç®¡ç†
- æ·»åŠ è§£æ¢¦å†å²è®°å½•
- é›†æˆæ•°æ®åº“å­˜å‚¨
- æ·»åŠ æ›´å¤šè§£æ¢¦é£æ ¼ï¼ˆå¦‚å‘¨å…¬è§£æ¢¦ã€è¥¿æ–¹å¿ƒç†å­¦ç­‰ï¼‰

## ğŸ¤ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. API keyæ˜¯å¦æ­£ç¡®é…ç½®
2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
4. Node.jsç‰ˆæœ¬æ˜¯å¦å…¼å®¹

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸŒŸ
